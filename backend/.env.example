# =============================================
# QuickVerdicts Backend - Environment Variables Template
# =============================================
#
# SECURITY INSTRUCTIONS:
# 1. Copy this file to .env: cp .env.example .env
# 2. Fill in actual values (NEVER commit .env to Git!)
# 3. For production: Use Azure Key Vault or AWS Secrets Manager
# 4. Rotate all secrets regularly
# 5. Use different credentials for dev/staging/production
#
# =============================================

# ============================================
# NODE CONFIGURATION
# ============================================
NODE_ENV=development
PORT=4000
HOST=0.0.0.0

# ============================================
# DATABASE CONFIGURATION (Azure SQL)
# ============================================
# PRODUCTION: Store these in Azure Key Vault or AWS Secrets Manager
# Example: your-server.database.windows.net
DB_SERVER=your-sql-server.database.windows.net
DB_NAME=QuickVerdicts_Dev
DB_USER=your-username@your-server
DB_PASSWORD=your-secure-password-change-this
DB_PORT=1433

# Database Pool Configuration (adjust for production load)
DB_POOL_MIN=5
DB_POOL_MAX=30

# ============================================
# JWT AUTHENTICATION
# ============================================
# CRITICAL: Generate new secret using this command:
# node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
#
# Example strong JWT secret (REPLACE THIS!):
JWT_SECRET=a1d8224189fe6bdf3429add7ad947b67731db0a37492c2cbcd8949e347bec34d58add1c380df5af7727e566408690b730103ce675972d37aabe432331f2961b0

# Token expiration times
JWT_ACCESS_EXPIRY=24h
JWT_REFRESH_EXPIRY=7d
JWT_REMEMBER_EXPIRY=30d

# ============================================
# AZURE BLOB STORAGE (Document Uploads)
# ============================================
# PRODUCTION: Store connection string in Azure Key Vault
# Get from: Azure Portal → Storage Account → Access Keys
AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=your-account;AccountKey=your-key-here;EndpointSuffix=core.windows.net
AZURE_BLOB_CONTAINER=warroom-documents

# ============================================
# AZURE COMMUNICATION SERVICES (ACS)
# ============================================
# For video calls and chat functionality
# Get from: Azure Portal → Communication Services → Keys
# PRODUCTION: Store in Azure Key Vault
ACS_CONNECTION_STRING=endpoint=https://your-acs.communication.azure.com/;accesskey=your-access-key-here
ACS_ENDPOINT=https://your-acs.communication.azure.com/

# ============================================
# EMAIL CONFIGURATION
# ============================================
# Gmail Setup (Development):
# 1. Enable 2FA on your Google account
# 2. Generate app password: https://myaccount.google.com/apppasswords
#
# PRODUCTION: Use dedicated email service (SendGrid, AWS SES, Azure Communication Services Email)
EMAIL_USER=your-email@gmail.com
EMAIL_APP_PASSWORD=your-gmail-app-password-here

# Email token expiration
EMAIL_VERIFICATION_EXPIRES_IN=24h
PASSWORD_RESET_EXPIRES_IN=1h

# ============================================
# URLS & CORS CONFIGURATION
# ============================================
# Development URLs
FRONTEND_URL=http://localhost:3000
API_BASE=http://localhost:4000

# Production URLs (update these for deployment)
# Example: https://quickverdicts.azurewebsites.net
PRODUCTION_URL=https://your-frontend-url.com

# CORS Security (PRODUCTION ONLY)
# Set to 'true' to require Origin header (blocks requests without origin)
# Recommended for production to prevent abuse
STRICT_CORS=true

# ============================================
# STRIPE PAYMENT PROCESSING
# ============================================
# ⚠️ CRITICAL FOR PRODUCTION: Use LIVE keys, not test keys!
# Get keys from: https://dashboard.stripe.com/apikeys

# Development - Use test keys
# STRIPE_SECRET_KEY=sk_test_your_test_key_here
# STRIPE_WEBHOOK_SECRET=whsec_your_test_webhook_secret_here

# Production - MUST use live keys (REQUIRED!)
STRIPE_SECRET_KEY=sk_live_your_live_key_here
STRIPE_WEBHOOK_SECRET=whsec_live_your_webhook_secret_here

# ⚠️ REMINDER: Update these before deploying to production!

# ============================================
# RATE LIMITING
# ============================================
# Global rate limit - Maximum requests per window per IP
RATE_LIMIT_MAX=5000
# Window in milliseconds (default: 15 minutes)
RATE_LIMIT_WINDOW_MS=900000

# Authentication endpoint rate limits (optional overrides)
# If not set, production uses strict limits, development uses relaxed limits
# RATE_LIMIT_SIGNUP=5           # Signup attempts per 15 minutes
# RATE_LIMIT_LOGIN=10           # Login attempts per 15 minutes
# RATE_LIMIT_ADMIN_LOGIN=3      # Admin login attempts per 15 minutes
# RATE_LIMIT_OTP=5              # OTP requests per hour
# RATE_LIMIT_OTP_VERIFY=10      # OTP verification attempts per 15 minutes
# RATE_LIMIT_PASSWORD_RESET=3   # Password reset requests per hour
# RATE_LIMIT_EMAIL_VERIFY=3     # Email verification requests per hour
# RATE_LIMIT_GENERAL_AUTH=50    # General auth requests per 15 minutes

# ============================================
# ERROR TRACKING & MONITORING (Optional)
# ============================================
# Sentry for error tracking
# SENTRY_DSN=https://your-key@sentry.io/project-id

# Azure Application Insights
# APPINSIGHTS_INSTRUMENTATIONKEY=your-instrumentation-key

# ============================================
# DEVELOPMENT OPTIONS
# ============================================
# Set to 'true' to allow builds with TypeScript/ESLint errors (dev only!)
# IGNORE_BUILD_ERRORS=false

# Enable debug mode
# DEBUG=false

# Log level: error, warn, info, debug
# LOG_LEVEL=info

# ============================================
# AWS APP SERVICE / AZURE APP SERVICE
# ============================================
# For production deployment, set environment variables in:
# - Azure: Configuration → Application Settings
# - AWS: Configuration → Environment Properties
#
# DO NOT use .env files in production!
# Use managed identities when possible for Azure resources

# ============================================
# AZURE SQL FIREWALL (PRODUCTION DEPLOYMENT)
# ============================================
# ⚠️ CRITICAL: Before deploying to Azure App Service:
# 1. Get your App Service outbound IP addresses from Azure Portal
# 2. Add firewall rules in Azure SQL Database to allow these IPs
# 3. Command to add firewall rule:
#    az sql server firewall-rule create \
#      --resource-group your-rg \
#      --server your-server \
#      --name AllowAppService \
#      --start-ip-address YOUR_APP_SERVICE_IP \
#      --end-ip-address YOUR_APP_SERVICE_IP

# ============================================
# ADDITIONAL NOTES
# ============================================
# 1. Validate all URLs don't have trailing slashes
# 2. Ensure DB firewall allows your server IPs
# 3. Test email configuration before deploying
# 4. Monitor rate limits and adjust as needed
# 5. Set up alerts for failed authentication attempts
# 6. Enable audit logging for compliance
